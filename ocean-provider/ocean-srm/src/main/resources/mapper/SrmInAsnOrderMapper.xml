<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fantechs.provider.srm.mapper.SrmInAsnOrderMapper">
    <resultMap id="BaseResultMap" type="com.fantechs.common.base.general.entity.srm.SrmInAsnOrder">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="asn_order_id" jdbcType="BIGINT" property="asnOrderId"/>
        <result column="source_order_id" jdbcType="BIGINT" property="sourceOrderId"/>
        <result column="core_source_sys_order_type_code" jdbcType="VARCHAR" property="corSourceSysOrderTypeCode"/>
        <result column="source_sys_order_type_code" jdbcType="VARCHAR" property="sourceSysOrderTypeCode"/>
        <result column="sys_order_type_code" jdbcType="VARCHAR" property="sysOrderTypeCode"/>
        <result column="material_owner_id" jdbcType="BIGINT" property="materialOwnerId"/>
        <result column="supplier_id" jdbcType="BIGINT" property="supplierId"/>
        <result column="warehouse_id" jdbcType="BIGINT" property="warehouseId"/>
        <result column="order_type_id" jdbcType="BIGINT" property="orderTypeId"/>
        <result column="storage_id" jdbcType="BIGINT" property="storageId"/>
        <result column="asn_code" jdbcType="VARCHAR" property="asnCode"/>
        <result column="plan_ago_date" jdbcType="TIMESTAMP" property="planAgoDate"/>
        <result column="start_receiving_date" jdbcType="TIMESTAMP" property="startReceivingDate"/>
        <result column="end_receiving_date" jdbcType="TIMESTAMP" property="endReceivingDate"/>
        <result column="deliver_date" jdbcType="TIMESTAMP" property="deliverDate"/>
        <result column="shipper_name" jdbcType="VARCHAR" property="shipperName"/>
        <result column="shipper_user_id" jdbcType="BIGINT" property="shipperUserId"/>
        <result column="link_man_name" jdbcType="VARCHAR" property="linkManName"/>
        <result column="link_man_phone" jdbcType="VARCHAR" property="linkManPhone"/>
        <result column="order_status" jdbcType="TINYINT" property="orderStatus"/>
        <result column="file_id" jdbcType="BIGINT" property="fileId"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="org_id" jdbcType="BIGINT" property="orgId"/>
        <result column="create_user_id" jdbcType="BIGINT" property="createUserId"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="modified_user_id" jdbcType="BIGINT" property="modifiedUserId"/>
        <result column="modified_time" jdbcType="TIMESTAMP" property="modifiedTime"/>
        <result column="is_delete" jdbcType="TINYINT" property="isDelete"/>
    </resultMap>

    <resultMap id="BaseResultDto" extends="BaseResultMap"
               type="com.fantechs.common.base.general.dto.srm.SrmInAsnOrderDto">
        <result column="material_owner_name" jdbcType="VARCHAR" property="materialOwnerName"/>
        <result column="supplier_name" jdbcType="VARCHAR" property="supplierName"/>
        <result column="order_type_name" jdbcType="VARCHAR" property="orderTypeName"/>
        <result column="organization_name" jdbcType="VARCHAR" property="organizationName"/>
        <result column="create_user_name" jdbcType="VARCHAR" property="createUserName"/>
        <result column="modified_user_name" jdbcType="VARCHAR" property="modifiedUserName"/>
        <result column="warehouse_name" jdbcType="VARCHAR" property="warehouseName"/>
        <result column="file_url" jdbcType="BIGINT" property="fileUrl"/>
        <collection property="srmInAsnOrderDetDtos" ofType="com.fantechs.common.base.general.dto.srm.SrmInAsnOrderDetDto"
                    column="{asnOrderId=asn_order_id}"
                    select="com.fantechs.provider.srm.mapper.SrmInAsnOrderDetMapper.findList">
        </collection>
    </resultMap>

    <sql id="BaseColumn">
    wiao.asn_order_id,
    wiao.source_order_id,
    wiao.core_source_sys_order_type_code,
    wiao.source_sys_order_type_code,
    wiao.sys_order_type_code,
    wiao.material_owner_id,
    wiao.supplier_id,
    wiao.warehouse_id,
    wiao.order_type_id,
    wiao.asn_code,
    wiao.storage_id,
    wiao.plan_ago_date,
    wiao.start_receiving_date,
    wiao.end_receiving_date,
    wiao.deliver_date,
    wiao.shipper_name,
    wiao.link_man_name,
    wiao.link_man_phone,
    wiao.order_status,
    wiao.file_id,
    wiao.status,
    wiao.remark,
    wiao.org_id,
    wiao.create_user_id,
    wiao.create_time,
    wiao.modified_user_id,
    wiao.modified_time,
    wiao.is_delete
  </sql>
    <select id="findList" resultMap="BaseResultDto">
        select<include refid="BaseColumn"/>,opo.purchase_order_code,bf.access_url AS file_url,
        bw.warehouse_name,material_owner_name,bs.supplier_name,boy.order_type_name,su.user_name AS create_user_name,
        sus.user_name AS modified_user_name,
        bo.organization_name AS organization_Name
        FROM wms_in_asn_order wiao
        LEFT JOIN om_purchase_order_det opod ON wiao.source_order_id = opod.purchase_order_det_id
        LEFT JOIN om_purchase_order opo ON opod.purchase_order_id = opo.purchase_order_id
        LEFT JOIN base_material_owner bmo ON wiao.material_owner_id=bmo.material_owner_id
        LEFT JOIN base_order_type boy on wiao.order_type_id = boy.order_type_id
        LEFT JOIN base_warehouse bw ON wiao.warehouse_id = bw.warehouse_id
        LEFT JOIN base_supplier bs ON wiao.supplier_id = bs.supplier_id
        LEFT JOIN base_file bf ON wiao.file_id = bf.file_id
        LEFT JOIN sys_user su ON wiao.create_user_id = su.user_id
        LEFT JOIN sys_user sus ON wiao.modified_user_id = sus.user_id
        LEFT JOIN base_organization bo ON wiao.org_id = bo.organization_id
        <where>
            <if test="asnOrderId !=null and asnOrderId !=''">
                and wiao.asn_order_id = #{asnOrderId}
            </if>
            <if test="asnCode!=null and asnCode!=''">
                and wiao.asn_code like CONCAT('%',#{asnCode},'%')
            </if>
            <if test="shipperName!=null and shipperName!=''">
                and wiao.shipper_name like CONCAT('%',#{shipperName},'%')
            </if>
            <if test="materialOwnerName!=null and materialOwnerName!=''">
                and bmo.material_owner_name like CONCAT('%',#{materialOwnerName},'%')
            </if>
            <if test="startTime != null and startTime != '' and endTime != null and endTime != ''">
                and date_format(wiao.order_date, '%Y-%m-%d') BETWEEN #{startTime} AND #{endTime}
            </if>
            <if test="orgId!=null and orgId!=''">
                and wiao.org_id = #{orgId}
            </if>
            <if test="orderTypeId!=null and orderTypeId!=''">
                and wiao.order_type_id = #{orderTypeId}
            </if>
            <if test="orderStatusList != null and orderStatusList.size()>0">
                and wiao.order_status
                <foreach collection="orderStatusList" open="in (" close=")" item="item" separator="," index="index">
                    #{item}
                </foreach>
            </if>
            <if test="orderStatus!=null and orderStatus!=''">
                and wiao.order_status = #{orderStatus}
            </if>
            <if test="orderTypeName!=null and orderTypeName!=''">
                and boy.order_type_name = #{orderTypeName}
            </if>
            <if test="orderTypeCode!=null and orderTypeCode!=''">
                and boy.order_type_code = #{orderTypeCode}
            </if>
            <if test="warehouseName!=null and warehouseName!=''">
                and bw.warehouse_name like CONCAT('%',#{warehouseName},'%')
            </if>
            <if test="corSourceSysOrderTypeCode!=null and corSourceSysOrderTypeCode!=''">
                and wiao.core_source_sys_order_type_code = #{corSourceSysOrderTypeCode}
            </if>
            <if test="sourceSysOrderTypeCode!=null and sourceSysOrderTypeCode!=''">
                and wiao.source_sys_order_type_code = #{sourceSysOrderTypeCode}
            </if>
            <if test="sysOrderTypeCode!=null and sysOrderTypeCode!=''">
                and wiao.sys_order_type_code = #{sysOrderTypeCode}
            </if>
            <choose>
                <when test="supplierIdList!=null and supplierIdList.size > 0">
                    and wiao.supplier_id in
                    <foreach collection="supplierIdList" item="item" separator="," open="(" close=")">
                        #{item.supplierId,jdbcType=BIGINT}
                    </foreach>
                </when>
            </choose>
        </where>
        order by wiao.create_time desc
    </select>


</mapper>